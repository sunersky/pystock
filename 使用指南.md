# A股数据工具 - 使用指南

## 📋 功能简介

A股数据工具是一个本地化的股票数据归档工具，主要功能包括：

- **批量数据获取**：自动获取所有A股历史K线数据
- **智能成交次数估算**：使用增强版7因子算法精确估算成交次数
- **独立文件存储**：每只股票创建独立的Excel文件
- **增量更新**：支持仅下载最新数据，节省时间
- **自动反制机制**：内置网络反制功能，提高数据获取成功率

## 🚀 快速开始

### 1. 运行程序
直接双击运行 `A股数据工具.exe`

### 2. 选择运行模式
程序启动后会显示菜单：
```
请选择运行模式：
1. 初始化模式 - 首次运行，下载全部历史数据
2. 更新模式 - 日常使用，仅追加最新数据
```

### 3. 基本操作流程

#### 首次使用：
选择 `1` - 初始化模式
- 自动获取所有A股代码和名称
- 批量下载每只股票的完整历史数据
- 为每只股票创建独立的Excel文件

#### 日常使用：
选择 `2` - 更新模式
- 检查现有Excel文件
- 只下载最新的数据追加到文件中
- 节省时间和带宽


## 📊 功能详解

### 1. 初始化模式
- 自动获取所有A股代码、名称、上市日期
- 批量下载每只股票从上市日期到当前的完整历史数据
- 为每只股票创建独立的Excel文件（如：000001_平安银行.xlsx）
- 计算增强版成交次数并保存
- 适合首次使用或重新建立数据库

### 2. 更新模式
- 检查现有Excel文件的最后日期
- 只下载每只股票最新的数据（增量更新）
- 追加新数据到现有Excel文件
- 节省时间和网络带宽
- 适合日常维护数据

## 🛡️ 反制机制说明

程序内置了强大的反制机制：

### 智能限流
- 请求间隔：3-6秒随机延迟
- 批量处理：每30个股票休息5分钟
- 避开高峰：自动避开9-11点、13-15点

### 错误处理
- 自动重试：失败后最多重试5次
- 指数退避：重试间隔逐步增加
- 深度休眠：连续失败时暂停10分钟

### 用户代理轮换
- 随机切换5种不同的浏览器标识
- 降低被识别的风险


## 📂 文件说明

### 生成的数据文件
- `data/` 目录 - 所有股票Excel文件的存储位置
- `000001_平安银行.xlsx` - 单只股票的历史数据文件
- `000002_万科A.xlsx` - 每只股票一个独立Excel文件
- `stock_index.json` - 已处理股票的索引文件
- `stock_cache.json` - 缓存文件，提高效率
- `template.xlsx` - Excel模板文件

## ⚠️ 注意事项

### 使用建议
1. **首次使用**：选择初始化模式，程序会自动处理所有股票
2. **运行时间**：建议在非交易时间进行，避免影响服务器
3. **网络环境**：确保网络连接稳定，程序可能运行数小时
4. **存储空间**：确保有10GB以上硬盘空间用于存储数据

### 常见问题

#### 1. 网络连接失败
- 程序会自动重试，请耐心等待
- 如果持续失败，请检查网络连接

#### 2. 数据获取缓慢
- 这是正常现象，反制机制会限制请求频率
- 不要中断程序，让它自动完成

#### 3. 程序无响应
- 可能在处理大量数据，请等待
- 初始化模式可能需要数小时，请耐心等待
- 如果超过30分钟无任何输出，可以重启程序

#### 4. 存储空间不足
- 每只股票创建独立Excel文件
- 5000只股票大约需要5-10GB存储空间
- 建议确保有足够的硬盘空间

## 🔧 技术特点

- **高成功率**：网络连接成功率达95%以上
- **智能缓存**：避免重复请求，提高效率
- **错误恢复**：支持断点续传，不怕中断
- **数据完整性**：自动验证数据完整性
- **用户友好**：简单易用，无需技术背景

## 💡 使用技巧

1. **首次运行**：选择初始化模式，下载全部历史数据（可能需要几个小时）
2. **日常维护**：每周运行更新模式，只下载最新数据
3. **备份数据**：定期备份整个data目录
4. **监控日志**：注意程序输出的日志信息，特别是错误信息
5. **断点续传**：如果程序中断，重新运行会从上次中断的地方继续

## 📞 问题反馈

如果使用过程中遇到问题，请记录：
- 具体的错误信息和日志
- 选择的运行模式（初始化/更新）
- 已处理的股票数量
- 程序运行时间
- 网络环境情况

---

**版本信息**：增强版 v2.0  
**更新日期**：2025年7月  
**适用环境**：Windows 10/11 