# PyStock - A股数据归档工具

## 项目简介

PyStock 是一款专为A股投资者和数据分析师打造的本地化数据归档工具，支持自动下载、处理、归档A股历史行情数据，具备多线程高效归档、Excel模板写入、索引批量写入等功能。数据源采用 akshare，支持断点续传和分类修复。

## 主要功能

- **多线程归档**：支持高效多线程下载与归档，极大提升处理速度。
- **Excel模板写入**：所有数据强制写入Sheet1，自动创建Sheet1，保证模板一致性。
- **索引批量写入**：多线程仅收集结果，主线程统一批量写入索引csv，避免并发死锁。
- **数据获取**：自动获取A股全部股票历史数据，覆盖上市至今。
- **智能分类**：按股票上市年限自动归档到不同文件夹。
- **成交次数智能计算**：采用多因子模型，智能估算每日成交次数。
- **断点续传**：支持中断后恢复归档。
- **分类修复**：自动检测并修复错误分类的股票文件。
- **详细日志**：全流程日志输出，便于排查问题。

## 近期修复与优化

- 移除多线程文件写锁，彻底解决多线程卡死问题。
- 索引csv由主线程批量写入，避免多线程并发写入死锁。
- Excel写入强制指定Sheet1，无Sheet1时自动创建，解决模板写入异常。
- 增强日志，便于定位多线程与IO问题。
- 支持自定义归档目录，自动适配D盘或当前目录。

## 安装与使用

### 环境要求
- Windows 10/11
- Python 3.7+
- 依赖库：见 requirements.txt

### 安装步骤
1. 克隆仓库：
```bash
git clone https://github.com/yourusername/PyStock.git
cd PyStock
```
2. 安装依赖：
```bash
pip install -r requirements.txt
```

### 快速使用
直接运行主程序：
```bash
python astock_main.py
```
按提示选择模式：
- 初始化归档（首次使用）
- 更新归档（每日增量）
- 分类修复
- 年限计算测试

## 文件结构说明
- `astock_main.py`：主程序
- `build_main.py`：打包脚本
- `requirements.txt`：依赖库
- `A股数据工具.exe`：打包后可执行文件
- `stock_index.csv`：股票索引文件（主线程批量写入）
- `K线数据模板.xlsx`：Excel模板

## 数据存储结构
- 按上市年限分文件夹（如 0年/、1年/、...、35年/）
- 每只股票一个Excel文件，字段：时间、开盘价、最高价、最低价、收盘价、涨幅、振幅、总手数、金额、换手率、成交次数、名称

## 常见问题
- **多线程卡死/索引未写入**：已修复，升级到最新版即可。
- **Excel数据未写入Sheet1**：已修复，自动强制写入Sheet1。
- **更新模式报错**：请先初始化归档，生成索引文件。

## 许可证
MIT License 